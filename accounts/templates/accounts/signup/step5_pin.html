{% extends 'accounts/signup/base_signup.html' %}

{% block content %}
<!-- Step 5: PIN Setup -->
<div class="step step-enter">
  <div class="text-center mb-8">
    <div class="h-16 w-16 rounded-2xl bg-gradient-to-br from-emerald-500 to-green-400 flex items-center justify-center mx-auto mb-4">
      <i data-lucide="shield-check" class="h-8 w-8 text-white"></i>
    </div>
    <h2 class="text-3xl font-bold bg-gradient-to-r from-white to-slate-300 bg-clip-text text-transparent">Set Your Secure PIN</h2>
    <p class="mt-3 text-slate-400 max-w-md mx-auto leading-relaxed">Create a 6-digit PIN for secure access to your NeoBank account</p>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div class="mb-6 p-4 rounded-xl {% if message.tags == 'error' %}bg-red-500/10 border border-red-400/20 text-red-300{% else %}bg-green-500/10 border border-green-400/20 text-green-300{% endif %}">
        <div class="flex items-center gap-3">
          <i data-lucide="{% if message.tags == 'error' %}alert-circle{% else %}check-circle{% endif %}" class="h-5 w-5"></i>
          <span>{{ message }}</span>
        </div>
      </div>
    {% endfor %}
  {% endif %}

  <form method="post" class="space-y-6">
    {% csrf_token %}
    
    <!-- PIN Input Fields -->
    <div class="grid sm:grid-cols-2 gap-6">
      <!-- PIN Field -->
      <div class="space-y-2">
        <label for="{{ form.pin.id_for_label }}" class="block text-sm font-semibold text-slate-200">Create PIN</label>
        <div class="relative">
          {{ form.pin }}
          <i data-lucide="lock" class="absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-slate-400"></i>
        </div>
        {% if form.pin.errors %}
          <div class="text-red-400 text-sm">{{ form.pin.errors.0 }}</div>
        {% endif %}
        <p class="text-xs text-slate-500">Choose a secure 6-digit PIN</p>
      </div>

      <!-- Confirm PIN Field -->
      <div class="space-y-2">
        <label for="{{ form.confirm_pin.id_for_label }}" class="block text-sm font-semibold text-slate-200">Confirm PIN</label>
        <div class="relative">
          {{ form.confirm_pin }}
          <i data-lucide="shield-check" class="absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-slate-400"></i>
        </div>
        {% if form.confirm_pin.errors %}
          <div class="text-red-400 text-sm">{{ form.confirm_pin.errors.0 }}</div>
        {% endif %}
        <p class="text-xs text-slate-500">Re-enter your PIN to confirm</p>
      </div>
    </div>

    <!-- PIN Strength Indicator (will be shown via JavaScript if needed) -->
    <div id="pinStrengthIndicator" class="hidden p-4 rounded-xl bg-slate-800/30 border border-slate-700/30">
      <div class="flex items-center gap-3">
        <i data-lucide="info" class="h-5 w-5 text-blue-400"></i>
        <div>
          <p class="text-sm text-slate-300 font-medium">PIN Strength</p>
          <p id="pinStrengthText" class="text-xs text-slate-400 mt-1">Enter your PIN to see strength</p>
        </div>
      </div>
    </div>

    <!-- Terms and Privacy Policy -->
    <div class="flex items-start gap-3 p-4 rounded-xl bg-slate-800/30 border border-slate-700/30">
      {{ form.terms }}
      <div>
        <label for="{{ form.terms.id_for_label }}" class="text-sm text-slate-300 font-medium">I agree to the Terms and Privacy Policy</label>
        <p class="text-xs text-slate-400 mt-1">By creating an account, you agree to our Terms of Service and Privacy Policy. Your PIN is encrypted and stored securely.</p>
      </div>
    </div>
    {% if form.terms.errors %}
      <div class="text-red-400 text-sm">{{ form.terms.errors.0 }}</div>
    {% endif %}

    <!-- Security Information -->
    <div class="grid gap-4">
      <div class="flex items-center gap-4 p-3 rounded-xl bg-emerald-500/10 border border-emerald-400/20">
        <div class="h-8 w-8 rounded-lg bg-emerald-500/20 flex items-center justify-center flex-shrink-0">
          <i data-lucide="shield-check" class="h-4 w-4 text-emerald-400"></i>
        </div>
        <div>
          <p class="text-sm text-emerald-300 font-medium">Bank-Grade Security</p>
          <p class="text-xs text-emerald-200/80 mt-1">Your PIN is encrypted using industry-standard hashing and never stored in plain text.</p>
        </div>
      </div>
      <div class="flex items-center gap-4 p-3 rounded-xl bg-blue-500/10 border border-blue-400/20">
        <div class="h-8 w-8 rounded-lg bg-blue-500/20 flex items-center justify-center flex-shrink-0">
          <i data-lucide="lock" class="h-4 w-4 text-blue-400"></i>
        </div>
        <div>
          <p class="text-sm text-blue-300 font-medium">Account Protection</p>
          <p class="text-xs text-blue-200/80 mt-1">Your account will be locked after 3 failed PIN attempts for 15 minutes.</p>
        </div>
      </div>
    </div>

    <!-- Navigation buttons -->
    <div class="mt-8 flex justify-between">
      <a href="{% url 'accounts:signup_step4' %}" class="px-6 py-3 rounded-2xl border border-slate-700/50 hover:border-slate-600/50 text-slate-300 hover:text-white transition-all duration-200 flex items-center gap-2">
        <i data-lucide="arrow-left" class="h-4 w-4"></i>
        Back
      </a>
      <button type="submit" class="px-8 py-3 rounded-2xl bg-gradient-to-r from-emerald-600 to-green-500 hover:from-emerald-700 hover:to-green-600 text-white font-semibold shadow-lg shadow-emerald-900/30 transition-all duration-200 flex items-center gap-2">
        Create Account
        <i data-lucide="shield-check" class="h-4 w-4"></i>
      </button>
    </div>
  </form>
</div>
{% endblock %}
