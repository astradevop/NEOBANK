{% extends 'accounts/signup/base_signup.html' %}

{% block content %}
<!-- Step 3: Aadhaar Verification -->
<div class="step step-enter">
  <div class="text-center mb-8">
    <div class="h-16 w-16 rounded-2xl bg-gradient-to-br from-orange-500 to-red-400 flex items-center justify-center mx-auto mb-4">
      <i data-lucide="fingerprint" class="h-8 w-8 text-white"></i>
    </div>
    <h2 class="text-3xl font-bold bg-gradient-to-r from-white to-slate-300 bg-clip-text text-transparent">Aadhaar Verification</h2>
    <p class="mt-3 text-slate-400 max-w-md mx-auto leading-relaxed">We'll verify your Aadhaar details with our secure database and send you an OTP for final confirmation</p>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div class="mb-6 p-4 rounded-xl {% if message.tags == 'error' %}bg-red-500/10 border border-red-400/20 text-red-300{% else %}bg-green-500/10 border border-green-400/20 text-green-300{% endif %}">
        <div class="flex items-center gap-3">
          <i data-lucide="{% if message.tags == 'error' %}alert-circle{% else %}check-circle{% endif %}" class="h-5 w-5"></i>
          <span>{{ message }}</span>
        </div>
      </div>
    {% endfor %}
  {% endif %}

  {% if not otp_sent %}
    <!-- Aadhaar Details Form -->
    <form method="post" class="space-y-6">
      {% csrf_token %}
      <input type="hidden" name="action" value="verify_aadhaar">
      
      <!-- Aadhaar Number Field -->
      <div class="space-y-2">
        <label for="{{ form.aadhaar_number.id_for_label }}" class="block text-sm font-semibold text-slate-200">Aadhaar Number</label>
        <div class="relative">
          {{ form.aadhaar_number }}
          <i data-lucide="credit-card" class="absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-slate-400"></i>
        </div>
        {% if form.aadhaar_number.errors %}
          <div class="text-red-400 text-sm">{{ form.aadhaar_number.errors.0 }}</div>
        {% endif %}
        <p class="text-xs text-slate-500">Enter your 12-digit Aadhaar number (spaces will be added automatically)</p>
      </div>

      <!-- Current Address Field -->
      <div class="space-y-2">
        <label for="{{ form.current_address.id_for_label }}" class="block text-sm font-semibold text-slate-200">Current Address</label>
        <div class="relative">
          {{ form.current_address }}
          <i data-lucide="home" class="absolute left-4 top-4 h-5 w-5 text-slate-400"></i>
        </div>
        {% if form.current_address.errors %}
          <div class="text-red-400 text-sm">{{ form.current_address.errors.0 }}</div>
        {% endif %}
        <p class="text-xs text-slate-500">Provide your current address (may differ from Aadhaar address)</p>
      </div>

      <!-- Consent Checkbox -->
      <div class="flex items-start gap-3 p-4 rounded-xl bg-slate-800/30 border border-slate-700/30">
        {{ form.aadhaar_consent }}
        <div>
          <label for="{{ form.aadhaar_consent.id_for_label }}" class="text-sm text-slate-300 font-medium">I authorize Aadhaar verification</label>
          <p class="text-xs text-slate-400 mt-1">I consent to verify my Aadhaar details for KYC compliance. We follow UIDAI guidelines and will only store masked references.</p>
        </div>
      </div>
      {% if form.aadhaar_consent.errors %}
        <div class="text-red-400 text-sm">{{ form.aadhaar_consent.errors.0 }}</div>
      {% endif %}

      <!-- Information Cards -->
      <div class="grid gap-4">
        <div class="flex items-center gap-4 p-3 rounded-xl bg-orange-500/10 border border-orange-400/20">
          <div class="h-8 w-8 rounded-lg bg-orange-500/20 flex items-center justify-center flex-shrink-0">
            <i data-lucide="shield-check" class="h-4 w-4 text-orange-400"></i>
          </div>
          <div>
            <p class="text-sm text-orange-300 font-medium">Secure Verification</p>
            <p class="text-xs text-orange-200/80 mt-1">Your Aadhaar details are verified against our pre-approved database for enhanced security.</p>
          </div>
        </div>
        <div class="flex items-center gap-4 p-3 rounded-xl bg-red-500/10 border border-red-400/20">
          <div class="h-8 w-8 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0">
            <i data-lucide="eye-off" class="h-4 w-4 text-red-400"></i>
          </div>
          <div>
            <p class="text-sm text-red-300 font-medium">Privacy Protected</p>
            <p class="text-xs text-red-200/80 mt-1">We never store complete Aadhaar numbers. Only masked tokens are retained as per regulations.</p>
          </div>
        </div>
      </div>

      <!-- Navigation buttons -->
      <div class="mt-8 flex justify-between">
        <a href="{% url 'accounts:signup_step2' %}" class="px-6 py-3 rounded-2xl border border-slate-700/50 hover:border-slate-600/50 text-slate-300 hover:text-white transition-all duration-200 flex items-center gap-2">
          <i data-lucide="arrow-left" class="h-4 w-4"></i>
          Back
        </a>
        <button type="submit" class="px-8 py-3 rounded-2xl bg-gradient-to-r from-orange-600 to-red-500 hover:from-orange-700 hover:to-red-600 text-white font-semibold shadow-lg shadow-orange-900/30 transition-all duration-200 flex items-center gap-2">
          Verify Aadhaar
          <i data-lucide="fingerprint" class="h-4 w-4"></i>
        </button>
      </div>
    </form>
  {% else %}
    <!-- OTP Verification -->
    <div class="space-y-6">
      <!-- Success message -->
      <div class="p-4 rounded-xl bg-green-500/10 border border-green-400/20 mb-6">
        <div class="flex items-center gap-3">
          <i data-lucide="check-circle" class="h-5 w-5 text-green-400"></i>
          <div>
            <p class="text-green-300 font-medium">Aadhaar Details Verified âœ…</p>
            <p class="text-green-200/80 text-sm mt-1">Your details match our records. Please enter the OTP sent for final verification.</p>
          </div>
        </div>
      </div>

      <!-- Aadhaar info display -->
      <div class="p-4 rounded-xl bg-slate-800/30 border border-slate-700/30">
        <div class="grid sm:grid-cols-2 gap-4 text-sm">
          <div>
            <span class="text-slate-400">Aadhaar:</span>
            <span class="font-mono text-orange-300 ml-2">{{ masked_aadhaar }}</span>
          </div>
          <div>
            <span class="text-slate-400">Name on Aadhaar:</span>
            <span class="text-slate-300 ml-2 font-medium">{{ aadhaar_name }}</span>
          </div>
        </div>
      </div>

      <!-- OTP Input Form -->
      <form method="post" class="space-y-6">
        {% csrf_token %}
        <input type="hidden" name="action" value="verify_otp">
        
        <div class="space-y-4">
          <label class="block text-sm font-semibold text-slate-200">Enter Aadhaar Verification OTP</label>
          <div class="aadhaar-otp grid grid-cols-6 gap-3" aria-label="Enter 6 digit Aadhaar OTP">
            <input name="otp_1" class="aadhaar-otp-input text-center text-2xl h-14 rounded-2xl border-2 border-white/10 bg-slate-900/60 font-bold focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50" inputmode="numeric" maxlength="1" />
            <input name="otp_2" class="aadhaar-otp-input text-center text-2xl h-14 rounded-2xl border-2 border-white/10 bg-slate-900/60 font-bold focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50" inputmode="numeric" maxlength="1" />
            <input name="otp_3" class="aadhaar-otp-input text-center text-2xl h-14 rounded-2xl border-2 border-white/10 bg-slate-900/60 font-bold focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50" inputmode="numeric" maxlength="1" />
            <input name="otp_4" class="aadhaar-otp-input text-center text-2xl h-14 rounded-2xl border-2 border-white/10 bg-slate-900/60 font-bold focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50" inputmode="numeric" maxlength="1" />
            <input name="otp_5" class="aadhaar-otp-input text-center text-2xl h-14 rounded-2xl border-2 border-white/10 bg-slate-900/60 font-bold focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50" inputmode="numeric" maxlength="1" />
            <input name="otp_6" class="aadhaar-otp-input text-center text-2xl h-14 rounded-2xl border-2 border-white/10 bg-slate-900/60 font-bold focus:ring-2 focus:ring-orange-500/50 focus:border-orange-500/50" inputmode="numeric" maxlength="1" />
          </div>
          {% if otp_form.otp.errors %}
            <div class="text-red-400 text-sm">{{ otp_form.otp.errors.0 }}</div>
          {% endif %}
        </div>

        <!-- OTP Info -->
        <div class="flex items-center justify-between p-4 rounded-xl bg-slate-800/30 border border-slate-700/30">
          <p class="text-slate-400 flex items-center gap-2">
            <i data-lucide="info" class="h-4 w-4"></i>
            Check console for OTP (demo mode)
          </p>
          <p class="text-slate-400 text-sm">Expires in 5 minutes</p>
        </div>

        <!-- Navigation buttons -->
        <div class="mt-8 flex justify-between">
          <a href="{% url 'accounts:signup_step2' %}" class="px-6 py-3 rounded-2xl border border-slate-700/50 hover:border-slate-600/50 text-slate-300 hover:text-white transition-all duration-200 flex items-center gap-2">
            <i data-lucide="arrow-left" class="h-4 w-4"></i>
            Back
          </a>
          <button type="submit" class="px-8 py-3 rounded-2xl bg-gradient-to-r from-orange-600 to-red-500 hover:from-orange-700 hover:to-red-600 text-white font-semibold shadow-lg shadow-orange-900/30 transition-all duration-200 flex items-center gap-2">
            Verify OTP
            <i data-lucide="arrow-right" class="h-4 w-4"></i>
          </button>
        </div>
      </form>
    </div>
  {% endif %}
</div>
{% endblock %}
