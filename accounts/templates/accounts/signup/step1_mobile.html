{% extends 'accounts/signup/base_signup.html' %}

{% block content %}
<!-- Step 1: Mobile Verification -->
<div class="step step-enter">
  <div class="text-center mb-8">
    <div class="h-16 w-16 rounded-2xl bg-gradient-to-br from-teal-500 to-cyan-400 flex items-center justify-center mx-auto mb-4">
      <i data-lucide="smartphone" class="h-8 w-8 text-slate-900"></i>
    </div>
    <h2 class="text-3xl font-bold bg-gradient-to-r from-white to-slate-300 bg-clip-text text-transparent">Verify Mobile Number</h2>
    <p class="mt-3 text-slate-400 max-w-md mx-auto leading-relaxed">We'll send a secure 6-digit OTP to your number for verification</p>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div class="mb-6 p-4 rounded-xl {% if message.tags == 'error' %}bg-red-500/10 border border-red-400/20 text-red-300{% else %}bg-green-500/10 border border-green-400/20 text-green-300{% endif %}">
        <div class="flex items-center gap-3">
          <i data-lucide="{% if message.tags == 'error' %}alert-circle{% else %}check-circle{% endif %}" class="h-5 w-5"></i>
          <span>{{ message }}</span>
        </div>
      </div>
    {% endfor %}
  {% endif %}

  {% if not otp_sent %}
    <!-- Mobile Number Form -->
    <form method="post" class="space-y-6">
      {% csrf_token %}
      <input type="hidden" name="action" value="send_otp">
      
      <div class="grid sm:grid-cols-[140px_1fr_auto] gap-4 items-end">
        <div>
          <label for="{{ mobile_form.country_code.id_for_label }}" class="block text-sm font-semibold text-slate-200 mb-2">Country</label>
          {{ mobile_form.country_code }}
        </div>
        <div>
          <label for="{{ mobile_form.phone.id_for_label }}" class="block text-sm font-semibold text-slate-200 mb-2">Mobile Number</label>
          <div class="relative">
            {{ mobile_form.phone }}
            <i data-lucide="phone" class="absolute left-4 top-1/2 transform -translate-y-1/2 h-5 w-5 text-slate-400"></i>
          </div>
          {% if mobile_form.phone.errors %}
            <div class="text-red-400 text-sm mt-1">{{ mobile_form.phone.errors.0 }}</div>
          {% endif %}
        </div>
        <button type="submit" class="h-12 px-6 rounded-2xl bg-gradient-to-r from-teal-600 to-cyan-500 hover:from-teal-700 hover:to-cyan-600 text-white font-semibold border border-teal-500/50 transition-all duration-200 flex items-center gap-2">
          <i data-lucide="send" class="h-4 w-4"></i>
          Send OTP
        </button>
      </div>
    </form>
  {% else %}
    <!-- OTP Verification Form -->
    <form method="post" class="space-y-6">
      {% csrf_token %}
      <input type="hidden" name="action" value="verify_otp">
      
      <div class="space-y-4">
        <label class="block text-sm font-semibold text-slate-200">Enter OTP</label>
        <div class="otp grid grid-cols-6 gap-3" aria-label="Enter 6 digit OTP">
          <input name="otp_1" class="otp-input text-center text-2xl h-14 rounded-2xl border-2 border-white/10 bg-slate-900/60 font-bold focus:ring-2 focus:ring-teal-500/50 focus:border-teal-500/50" inputmode="numeric" maxlength="1" />
          <input name="otp_2" class="otp-input text-center text-2xl h-14 rounded-2xl border-2 border-white/10 bg-slate-900/60 font-bold focus:ring-2 focus:ring-teal-500/50 focus:border-teal-500/50" inputmode="numeric" maxlength="1" />
          <input name="otp_3" class="otp-input text-center text-2xl h-14 rounded-2xl border-2 border-white/10 bg-slate-900/60 font-bold focus:ring-2 focus:ring-teal-500/50 focus:border-teal-500/50" inputmode="numeric" maxlength="1" />
          <input name="otp_4" class="otp-input text-center text-2xl h-14 rounded-2xl border-2 border-white/10 bg-slate-900/60 font-bold focus:ring-2 focus:ring-teal-500/50 focus:border-teal-500/50" inputmode="numeric" maxlength="1" />
          <input name="otp_5" class="otp-input text-center text-2xl h-14 rounded-2xl border-2 border-white/10 bg-slate-900/60 font-bold focus:ring-2 focus:ring-teal-500/50 focus:border-teal-500/50" inputmode="numeric" maxlength="1" />
          <input name="otp_6" class="otp-input text-center text-2xl h-14 rounded-2xl border-2 border-white/10 bg-slate-900/60 font-bold focus:ring-2 focus:ring-teal-500/50 focus:border-teal-500/50" inputmode="numeric" maxlength="1" />
        </div>
        {% if otp_form.otp.errors %}
          <div class="text-red-400 text-sm">{{ otp_form.otp.errors.0 }}</div>
        {% endif %}
      </div>

      <div class="flex items-center justify-between p-4 rounded-xl bg-slate-800/30 border border-slate-700/30">
        <p class="text-slate-400 flex items-center gap-2">
          <i data-lucide="info" class="h-4 w-4"></i>
          Enter the code sent to {{ phone_display }}
        </p>
        <a href="?resend=1" class="text-teal-400 hover:text-teal-300 font-medium transition-colors duration-200">
          Resend OTP
        </a>
      </div>

      <div class="mt-8 flex justify-between">
        <a href="{% url 'index' %}" class="px-6 py-3 rounded-2xl border border-slate-700/50 hover:border-slate-600/50 text-slate-300 hover:text-white transition-all duration-200 flex items-center gap-2">
          <i data-lucide="arrow-left" class="h-4 w-4"></i>
          Cancel
        </a>
        <button type="submit" class="px-8 py-3 rounded-2xl bg-gradient-to-r from-teal-600 to-cyan-500 hover:from-teal-700 hover:to-cyan-600 text-white font-semibold shadow-lg shadow-teal-900/30 transition-all duration-200 flex items-center gap-2">
          Verify & Continue
          <i data-lucide="arrow-right" class="h-4 w-4"></i>
        </button>
      </div>
    </form>
  {% endif %}
</div>
{% endblock %}
